<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>application.js - SNJS Documentation</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AccountSyncOperation.html">AccountSyncOperation</a></li><li><a href="AccountSyncResponseResolver.html">AccountSyncResponseResolver</a></li><li><a href="DeviceInterface.html">DeviceInterface</a></li><li><a href="HistorySession.html">HistorySession</a></li><li><a href="ItemsKeyManager.html">ItemsKeyManager</a><ul class='methods'><li data-type='method'><a href="ItemsKeyManager.html#addItemsKeyChangeObserver">addItemsKeyChangeObserver</a></li><li data-type='method'><a href="ItemsKeyManager.html#createNewDefaultItemsKey">createNewDefaultItemsKey</a></li><li data-type='method'><a href="ItemsKeyManager.html#defaultItemsKeyForItemVersion">defaultItemsKeyForItemVersion</a></li><li data-type='method'><a href="ItemsKeyManager.html#getDefaultItemsKey">getDefaultItemsKey</a></li><li data-type='method'><a href="ItemsKeyManager.html#handleDownloadFirstSyncCompletion">handleDownloadFirstSyncCompletion</a></li><li data-type='method'><a href="ItemsKeyManager.html#reencryptItemsKeys">reencryptItemsKeys</a></li><li data-type='method'><a href="ItemsKeyManager.html#setKeyManager">setKeyManager</a></li></ul></li><li><a href="OfflineSyncOperation_OfflineSyncOperation.html">OfflineSyncOperation</a></li><li><a href="PayloadCollection.html">PayloadCollection</a></li><li><a href="PayloadCollectionSet_PayloadCollectionSet.html">PayloadCollectionSet</a></li><li><a href="PayloadsDelta.html">PayloadsDelta</a></li><li><a href="PurePayload.html">PurePayload</a></li><li><a href="SFItem.html">SFItem</a><ul class='methods'><li data-type='method'><a href="SFItem.html#appDatacontentKeysToIgnoreWhenCheckingEquality">appDatacontentKeysToIgnoreWhenCheckingEquality</a></li><li data-type='method'><a href="SFItem.html#collapseContent">collapseContent</a></li><li data-type='method'><a href="SFItem.html#contentKeysToIgnoreWhenCheckingEquality">contentKeysToIgnoreWhenCheckingEquality</a></li><li data-type='method'><a href="SFItem.html#createdAtString">createdAtString</a></li><li data-type='method'><a href="SFItem.html#initUUID">initUUID</a></li><li data-type='method'><a href="SFItem.html#populateDefaultContentValues">populateDefaultContentValues</a></li><li data-type='method'><a href="SFItem.html#setIsBeingReferencedBy">setIsBeingReferencedBy</a></li><li data-type='method'><a href="SFItem.html#strategyWhenConflictingWithItem">strategyWhenConflictingWithItem</a></li><li data-type='method'><a href="SFItem.html#updateLocalRelationships">updateLocalRelationships</a></li></ul></li><li><a href="SNActionsService.html">SNActionsService</a><ul class='methods'><li data-type='method'><a href="SNActionsService.html#loadExtensionInContextOfItem">loadExtensionInContextOfItem</a></li></ul></li><li><a href="SNAlertService.html">SNAlertService</a></li><li><a href="SNApplication.html">SNApplication</a><ul class='methods'><li data-type='method'><a href="SNApplication.html#addEventObserver">addEventObserver</a></li><li data-type='method'><a href="SNApplication.html#addSingleEventObserver">addSingleEventObserver</a></li><li data-type='method'><a href="SNApplication.html#changeDeviceInterface">changeDeviceInterface</a></li><li data-type='method'><a href="SNApplication.html#changePasscode">changePasscode</a></li><li data-type='method'><a href="SNApplication.html#changePassword">changePassword</a></li><li data-type='method'><a href="SNApplication.html#clearDatabase">clearDatabase</a></li><li data-type='method'><a href="SNApplication.html#createItem">createItem</a></li><li data-type='method'><a href="SNApplication.html#deinit">deinit</a></li><li data-type='method'><a href="SNApplication.html#deleteItem">deleteItem</a></li><li data-type='method'><a href="SNApplication.html#deleteItemLocally">deleteItemLocally</a></li><li data-type='method'><a href="SNApplication.html#emptyTrash">emptyTrash</a></li><li data-type='method'><a href="SNApplication.html#findItem">findItem</a></li><li data-type='method'><a href="SNApplication.html#findItems">findItems</a></li><li data-type='method'><a href="SNApplication.html#findOrCreateTag">findOrCreateTag</a></li><li data-type='method'><a href="SNApplication.html#findTag">findTag</a></li><li data-type='method'><a href="SNApplication.html#generateUuid">generateUuid</a></li><li data-type='method'><a href="SNApplication.html#getDisplayableItems">getDisplayableItems</a></li><li data-type='method'><a href="SNApplication.html#getHost">getHost</a></li><li data-type='method'><a href="SNApplication.html#getItems">getItems</a></li><li data-type='method'><a href="SNApplication.html#getNoteCount">getNoteCount</a></li><li data-type='method'><a href="SNApplication.html#getNotesMatchingSmartTag">getNotesMatchingSmartTag</a></li><li data-type='method'><a href="SNApplication.html#getSmartTags">getSmartTags</a></li><li data-type='method'><a href="SNApplication.html#getSyncStatus">getSyncStatus</a></li><li data-type='method'><a href="SNApplication.html#getTrashedItems">getTrashedItems</a></li><li data-type='method'><a href="SNApplication.html#getUser">getUser</a></li><li data-type='method'><a href="SNApplication.html#getUserVersion">getUserVersion</a></li><li data-type='method'><a href="SNApplication.html#getValue">getValue</a></li><li data-type='method'><a href="SNApplication.html#hasPasscode">hasPasscode</a></li><li data-type='method'><a href="SNApplication.html#importData">importData</a></li><li data-type='method'><a href="SNApplication.html#isDatabaseLoaded">isDatabaseLoaded</a></li><li data-type='method'><a href="SNApplication.html#isEphemeralSession">isEphemeralSession</a></li><li data-type='method'><a href="SNApplication.html#isLocked">isLocked</a></li><li data-type='method'><a href="SNApplication.html#isStarted">isStarted</a></li><li data-type='method'><a href="SNApplication.html#launch">launch</a></li><li data-type='method'><a href="SNApplication.html#lock">lock</a></li><li data-type='method'><a href="SNApplication.html#mergeItem">mergeItem</a></li><li data-type='method'><a href="SNApplication.html#noAccount">noAccount</a></li><li data-type='method'><a href="SNApplication.html#prepareForLaunch">prepareForLaunch</a></li><li data-type='method'><a href="SNApplication.html#register">register</a></li><li data-type='method'><a href="SNApplication.html#registerService">registerService</a></li><li data-type='method'><a href="SNApplication.html#removePasscode">removePasscode</a></li><li data-type='method'><a href="SNApplication.html#removeValue">removeValue</a></li><li data-type='method'><a href="SNApplication.html#resolveOutOfSync">resolveOutOfSync</a></li><li data-type='method'><a href="SNApplication.html#restart">restart</a></li><li data-type='method'><a href="SNApplication.html#saveItem">saveItem</a></li><li data-type='method'><a href="SNApplication.html#saveItems">saveItems</a></li><li data-type='method'><a href="SNApplication.html#savePayload">savePayload</a></li><li data-type='method'><a href="SNApplication.html#setHost">setHost</a></li><li data-type='method'><a href="SNApplication.html#setItemNeedsSync">setItemNeedsSync</a></li><li data-type='method'><a href="SNApplication.html#setItemsNeedsSync">setItemsNeedsSync</a></li><li data-type='method'><a href="SNApplication.html#setPasscode">setPasscode</a></li><li data-type='method'><a href="SNApplication.html#setStorageEncryptionPolicy">setStorageEncryptionPolicy</a></li><li data-type='method'><a href="SNApplication.html#setValue">setValue</a></li><li data-type='method'><a href="SNApplication.html#signIn">signIn</a></li><li data-type='method'><a href="SNApplication.html#signOut">signOut</a></li><li data-type='method'><a href="SNApplication.html#streamItems">streamItems</a></li><li data-type='method'><a href="SNApplication.html#sync">sync</a></li><li data-type='method'><a href="SNApplication.html#validateAccountPassword">validateAccountPassword</a></li></ul></li><li><a href="SNComponentManager.html">SNComponentManager</a><ul class='methods'><li data-type='method'><a href="SNComponentManager.html#deinit">deinit</a></li><li data-type='method'><a href="SNComponentManager.html#registerComponentWindow">registerComponentWindow</a></li></ul></li><li><a href="SNEditor.html">SNEditor</a></li><li><a href="SNHistoryManager.html">SNHistoryManager</a></li><li><a href="SNHttpService.html">SNHttpService</a></li><li><a href="SNKeyManager.html">SNKeyManager</a><ul class='methods'><li data-type='method'><a href="SNKeyManager.html#clearLocalKeyState">clearLocalKeyState</a></li><li data-type='method'><a href="SNKeyManager.html#contentTypeUsesRootKeyEncryption">contentTypeUsesRootKeyEncryption</a></li><li data-type='method'><a href="SNKeyManager.html#getAccountKeyParams">getAccountKeyParams</a></li><li data-type='method'><a href="SNKeyManager.html#getRootKey">getRootKey</a></li><li data-type='method'><a href="SNKeyManager.html#getRootKeyParams">getRootKeyParams</a></li><li data-type='method'><a href="SNKeyManager.html#getRootKeyWrapperKeyParams">getRootKeyWrapperKeyParams</a></li><li data-type='method'><a href="SNKeyManager.html#hasPasscode">hasPasscode</a></li><li data-type='method'><a href="SNKeyManager.html#hasRootKeyWrapper">hasRootKeyWrapper</a></li><li data-type='method'><a href="SNKeyManager.html#keyToUseForDecryptionOfPayload">keyToUseForDecryptionOfPayload</a></li><li data-type='method'><a href="SNKeyManager.html#keyToUseForEncryptionOfPayload">keyToUseForEncryptionOfPayload</a></li><li data-type='method'><a href="SNKeyManager.html#onStatusChange">onStatusChange</a></li><li data-type='method'><a href="SNKeyManager.html#removeRootKeyWrapper">removeRootKeyWrapper</a></li><li data-type='method'><a href="SNKeyManager.html#rootKeyNeedsUnwrapping">rootKeyNeedsUnwrapping</a></li><li data-type='method'><a href="SNKeyManager.html#setDeviceInterface">setDeviceInterface</a></li><li data-type='method'><a href="SNKeyManager.html#setNewRootKey">setNewRootKey</a></li><li data-type='method'><a href="SNKeyManager.html#setNewRootKeyWrapper">setNewRootKeyWrapper</a></li><li data-type='method'><a href="SNKeyManager.html#unwrapRootKey">unwrapRootKey</a></li><li data-type='method'><a href="SNKeyManager.html#validateAccountPassword">validateAccountPassword</a></li><li data-type='method'><a href="SNKeyManager.html#validatePasscode">validatePasscode</a></li><li data-type='method'><a href="SNKeyManager.html#validateWrappingKey">validateWrappingKey</a></li></ul></li><li><a href="SNMaxItemPayload.html">SNMaxItemPayload</a></li><li><a href="SNMigrationService.html">SNMigrationService</a><ul class='methods'><li data-type='method'><a href="SNMigrationService.html#handleApplicationStage">handleApplicationStage</a></li></ul></li><li><a href="SNModelManager.html">SNModelManager</a><ul class='methods'><li data-type='method'><a href="SNModelManager.html#addItem">addItem</a></li><li data-type='method'><a href="SNModelManager.html#createItem">createItem</a></li><li data-type='method'><a href="SNModelManager.html#getMasterCollection">getMasterCollection</a></li><li data-type='method'><a href="SNModelManager.html#insertItem">insertItem</a></li><li data-type='method'><a href="SNModelManager.html#insertItems">insertItems</a></li><li data-type='method'><a href="SNModelManager.html#setItemDirty">setItemDirty</a></li><li data-type='method'><a href="SNModelManager.html#setItemProperties">setItemProperties</a></li></ul></li><li><a href="SNNote.html">SNNote</a><ul class='methods'><li data-type='method'><a href="SNNote.html#appDatacontentKeysToIgnoreWhenCheckingEquality">appDatacontentKeysToIgnoreWhenCheckingEquality</a></li><li data-type='method'><a href="SNNote.html#collapseContent">collapseContent</a></li><li data-type='method'><a href="SNNote.html#contentKeysToIgnoreWhenCheckingEquality">contentKeysToIgnoreWhenCheckingEquality</a></li><li data-type='method'><a href="SNNote.html#createdAtString">createdAtString</a></li><li data-type='method'><a href="SNNote.html#initUUID">initUUID</a></li><li data-type='method'><a href="SNNote.html#populateDefaultContentValues">populateDefaultContentValues</a></li><li data-type='method'><a href="SNNote.html#setIsBeingReferencedBy">setIsBeingReferencedBy</a></li><li data-type='method'><a href="SNNote.html#strategyWhenConflictingWithItem">strategyWhenConflictingWithItem</a></li><li data-type='method'><a href="SNNote.html#updateLocalRelationships">updateLocalRelationships</a></li></ul></li><li><a href="SNNoteSFItem.html">SFItem</a></li><li><a href="SNNoteSNNoteSFItem.html">SFItem</a></li><li><a href="SNPrivilegesService.html">SNPrivilegesService</a><ul class='methods'><li data-type='method'><a href="SNPrivilegesService.html#actionRequiresPrivilege">actionRequiresPrivilege</a></li><li data-type='method'><a href="SNPrivilegesService.html#netCredentialsForAction">netCredentialsForAction</a></li></ul></li><li><a href="SNProtocolOperator.html">SNProtocolOperator</a><ul class='methods'><li data-type='method'><a href="SNProtocolOperator.html#createItemsKey">createItemsKey</a></li><li data-type='method'><a href="SNProtocolOperator.html#generateNewItemsKeyContent">generateNewItemsKeyContent</a></li></ul></li><li><a href="SNProtocolService.html">SNProtocolService</a><ul class='methods'><li data-type='method'><a href="SNProtocolService.html#compareRootKeys">compareRootKeys</a></li><li data-type='method'><a href="SNProtocolService.html#createBackupFile">createBackupFile</a></li><li data-type='method'><a href="SNProtocolService.html#decryptErroredItems">decryptErroredItems</a></li><li data-type='method'><a href="SNProtocolService.html#payloadByDecryptingPayload">payloadByDecryptingPayload</a></li><li data-type='method'><a href="SNProtocolService.html#payloadByEncryptingPayload">payloadByEncryptingPayload</a></li><li data-type='method'><a href="SNProtocolService.html#setKeyManager">setKeyManager</a></li><li data-type='method'><a href="SNProtocolService.html#supportedVersions">supportedVersions</a></li></ul></li><li><a href="SNRootKey.html">SNRootKey</a><ul class='methods'><li data-type='method'><a href="SNRootKey.html#compare">compare</a></li><li data-type='method'><a href="SNRootKey.html#getPersistableValue">getPersistableValue</a></li></ul></li><li><a href="SNRootKeyParams.html">SNRootKeyParams</a><ul class='methods'><li data-type='method'><a href="SNRootKeyParams.html#getPortableValue">getPortableValue</a></li></ul></li><li><a href="SNSavedServerItemPayload.html">SNSavedServerItemPayload</a></li><li><a href="SNSessionManager.html">SNSessionManager</a></li><li><a href="SNSingletonManager.html">SNSingletonManager</a><ul class='methods'><li data-type='method'><a href="SNSingletonManager.html#addObservers">addObservers</a></li><li data-type='method'><a href="SNSingletonManager.html#registerPredicate">registerPredicate</a></li></ul></li><li><a href="SNStorageService.html">SNStorageService</a><ul class='methods'><li data-type='method'><a href="SNStorageService.html#canDecryptWithKey">canDecryptWithKey</a></li><li data-type='method'><a href="SNStorageService.html#clearValues">clearValues</a></li><li data-type='method'><a href="SNStorageService.html#decryptStorage">decryptStorage</a></li><li data-type='method'><a href="SNStorageService.html#generatePersistenceValue">generatePersistenceValue</a></li><li data-type='method'><a href="SNStorageService.html#getAllRawPayloads">getAllRawPayloads</a></li><li data-type='method'><a href="SNStorageService.html#getPersistenceKey">getPersistenceKey</a></li><li data-type='method'><a href="SNStorageService.html#handleApplicationStage">handleApplicationStage</a></li><li data-type='method'><a href="SNStorageService.html#isStorageWrapped">isStorageWrapped</a></li><li data-type='method'><a href="SNStorageService.html#setInitialValues">setInitialValues</a></li></ul></li><li><a href="SNSyncService.html">SNSyncService</a><ul class='methods'><li data-type='method'><a href="SNSyncService.html#computeDataIntegrityHash">computeDataIntegrityHash</a></li><li data-type='method'><a href="SNSyncService.html#getDatabasePayloads">getDatabasePayloads</a></li><li data-type='method'><a href="SNSyncService.html#handleNeverSyncedDeleted">handleNeverSyncedDeleted</a></li><li data-type='method'><a href="SNSyncService.html#isDatabaseLoaded">isDatabaseLoaded</a></li><li data-type='method'><a href="SNSyncService.html#loadDatabasePayloads">loadDatabasePayloads</a></li><li data-type='method'><a href="SNSyncService.html#markAllItemsAsNeedingSync">markAllItemsAsNeedingSync</a></li><li data-type='method'><a href="SNSyncService.html#payloadsByPreparingForServer">payloadsByPreparingForServer</a></li><li data-type='method'><a href="SNSyncService.html#popPayloadsNeedingPreSyncSave">popPayloadsNeedingPreSyncSave</a></li><li data-type='method'><a href="SNSyncService.html#popSpawnQueue">popSpawnQueue</a></li><li data-type='method'><a href="SNSyncService.html#repersistAllItems">repersistAllItems</a></li><li data-type='method'><a href="SNSyncService.html#resetSyncState">resetSyncState</a></li><li data-type='method'><a href="SNSyncService.html#resolveOutOfSync">resolveOutOfSync</a></li><li data-type='method'><a href="SNSyncService.html#sync">sync</a></li><li data-type='method'><a href="SNSyncService.html#ut_beginLatencySimulator">ut_beginLatencySimulator</a></li><li data-type='method'><a href="SNSyncService.html#ut_endLatencySimulator">ut_endLatencySimulator</a></li><li data-type='method'><a href="SNSyncService.html#ut_setDatabaseLoaded">ut_setDatabaseLoaded</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#arrayByDifference">arrayByDifference</a></li><li><a href="global.html#arrayByRemovingFromIndex">arrayByRemovingFromIndex</a></li><li><a href="global.html#compareVersions">compareVersions</a></li><li><a href="global.html#deepMerge">deepMerge</a></li><li><a href="global.html#DEFAULT_AUTO_SYNC_INTERVAL">DEFAULT_AUTO_SYNC_INTERVAL</a></li><li><a href="global.html#DEFAULT_ITEM_REVISIONS_THRESHOLD">DEFAULT_ITEM_REVISIONS_THRESHOLD</a></li><li><a href="global.html#extendArray">extendArray</a></li><li><a href="global.html#intentRequiresEncryption">intentRequiresEncryption</a></li><li><a href="global.html#KEY_MODE_ROOT_KEY_NONE">KEY_MODE_ROOT_KEY_NONE</a></li><li><a href="global.html#KEY_MODE_ROOT_KEY_ONLY">KEY_MODE_ROOT_KEY_ONLY</a></li><li><a href="global.html#KEY_MODE_ROOT_KEY_PLUS_WRAPPER">KEY_MODE_ROOT_KEY_PLUS_WRAPPER</a></li><li><a href="global.html#KEY_MODE_WRAPPER_ONLY">KEY_MODE_WRAPPER_ONLY</a></li><li><a href="global.html#LARGE_ENTRY_DELTA_THRESHOLD">LARGE_ENTRY_DELTA_THRESHOLD</a></li><li><a href="global.html#LAST_NONROOT_ITEMS_KEY_VERSION">LAST_NONROOT_ITEMS_KEY_VERSION</a></li><li><a href="global.html#lastElement">lastElement</a></li><li><a href="global.html#omitByCopy">omitByCopy</a></li><li><a href="global.html#PayloadsByAlternatingUuid">PayloadsByAlternatingUuid</a></li><li><a href="global.html#PayloadsByDuplicating">PayloadsByDuplicating</a></li><li><a href="global.html#pickByCopy">pickByCopy</a></li><li><a href="global.html#RAW_STORAGE_KEY_LAST_MIGRATION_TIMESTAMP">RAW_STORAGE_KEY_LAST_MIGRATION_TIMESTAMP</a></li><li><a href="global.html#removeFromArray">removeFromArray</a></li><li><a href="global.html#removeFromIndex">removeFromIndex</a></li><li><a href="global.html#SortPayloadsByRecentAndContentPriority">SortPayloadsByRecentAndContentPriority</a></li><li><a href="global.html#StorageEncryptionPolicies">StorageEncryptionPolicies</a></li><li><a href="global.html#StoragePersistencePolicies">StoragePersistencePolicies</a></li><li><a href="global.html#StorageValueModes">StorageValueModes</a></li><li><a href="global.html#subtractFromArray">subtractFromArray</a></li><li><a href="global.html#ValueModesKeys">ValueModesKeys</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">application.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { removeFromArray, isNullOrUndefined } from '@Lib/utils';
import { ContentTypes } from '@Models/content_types';
import { CopyPayload } from '@Payloads/generator';
import { ApplicationEvents, ApplicationStages, applicationEventForSyncEvent } from '@Lib';
import { StoragePersistencePolicies } from '@Services';
import {
  SNMigrationService,
  SNActionsService,
  SNApiService,
  SNModelManager,
  SNProtocolService,
  SNPrivilegesService,
  SNHistoryManager,
  SNAlertService,
  SNSessionManager,
  SNComponentManager,
  SNHttpService,
  SNSingletonManager,
  SNKeyManager,
  ItemsKeyManager,
  SNStorageService,
  SNSyncService,
  DeviceAuthService,
  SyncModes
} from './services';

/** How often to automatically sync, in milliseconds */
const DEFAULT_AUTO_SYNC_INTERVAL = 30000;

/** The main entrypoint of an application. */
export class SNApplication {
  /**
   * @param {object} params
   * @param {Environments} params.environment
      Required - The Environment that identifies your application.
   * @param {Platforms} params.platform
      Required - The Platform that identifies your application.
   * @param {string} params.namespace
      Optional - a unique identifier to namespace storage and
      other persistent properties. Defaults to empty string.
   * @param {DeviceInterface} params.deviceInterface
      A DeviceInterface object.
   * @param {array} params.swapClasses
      Gives consumers the ability to provide their own custom
      subclass for a service. swapClasses should be an array
      of key/value pairs consisting of keys 'swap' and 'with'.
      'swap' is the base class you wish to replace, and 'with'
      is the custom subclass to use.
   * @param {array} params.skipClasses
      An optional array of classes to skip making services for.
   * @param {SNCrypto} params.crypto
      The platform-dependent instance of SNCrypto to use.
      Web uses SNWebCrypto, mobile uses SNReactNativeCrypto.
   */
  constructor({
    environment,
    platform,
    namespace,
    host,
    deviceInterface,
    swapClasses,
    skipClasses,
    crypto
  } = {}) {
    if (!deviceInterface) {
      throw 'Device Interface must be supplied.';
    }
    if (!environment) {
      throw 'Environment must be supplied when creating an application.';
    }
    if (!platform) {
      throw 'Platform must be supplied when creating an application.';
    }
    this.environment = environment;
    this.platform = platform;
    this.namespace = namespace || '';
    this.host = host;
    this.deviceInterface = deviceInterface;
    this.crypto = crypto;
    this.swapClasses = swapClasses;
    this.skipClasses = skipClasses;
    this.eventHandlers = [];
    this.services = [];
    this.streamObservers = [];
    this.serviceObservers = [];
    this.managedSubscribers = [];
    this.constructServices();
  }

  /**
   * The first thing consumers should call when starting their app.
   * This function will load all services in their correct order.
   * @access public
   * @param {object} params
   * @param {object} params.callbacks
   * @param {async|function} params.callbacks.requiresChallengeResponses
   * Return an array of ChallengeResponse for each Challenge.
   * @param {Array.&lt;Challenge>} params.callbacks.requiresChallengeResponses.challenges  
   * An array of challenges that need a ChallengeResponse.
   * @param {async|function} params.callbacks.handleChallengeFailures
   * @param {Array.&lt;ChallengeResponse>} params.callbacks.handleChallengeFailures.failedResponses
   * An array of ChallengeResponse that have failed.
   */
  async prepareForLaunch({ callbacks }) {
    if (!callbacks.requiresChallengeResponses) {
      throw 'Application.launch callbacks are not properly configured.';
    }
    this.launchCallbacks = callbacks;
    await this.deviceInterface.openDatabase();
    await this.migrationService.initialize();
    await this.handleStage(ApplicationStages.PreparingForLaunch_0);
    await this.storageService.initializeFromDisk();
    await this.keyManager.initialize();
    await this.handleStage(ApplicationStages.ReadyForLaunch_05);
    this.started = true;
    await this.notifyEvent(ApplicationEvents.Started);
  }

  /**
   * Runs migrations, handles device authentication, unlocks application, and
   * issues a callback if a device activation requires user input
   * (i.e local passcode or fingerprint).
   * @access public
   * @param {bool} params.awaitDatabaseLoad  Option to await database load before marking the app 
   *                           as ready. Used as far as we know for .restart and unit tests.
   */
  async launch({ awaitDatabaseLoad } = {}) {
    await this.handleLaunchAuthentication();
    if (await this.storageService.isStorageWrapped()) {
      await this.storageService.decryptStorage();
    }
    await this.sessionManager.initializeFromDisk();
    this.historyManager.initializeFromDisk();

    this.unlocked = true;
    await this.notifyEvent(ApplicationEvents.Launched);
    await this.handleStage(ApplicationStages.StorageDecrypted_09);
    await this.handleStage(ApplicationStages.Launched_10);

    const databasePayloads = await this.syncService.getDatabasePayloads();
    await this.handleStage(ApplicationStages.LoadingDatabase_11);
    /**
    * We don't want to await this, as we want to begin allowing the app to function
    * before local data has been loaded fully. We await only initial
    * `getDatabasePayloads` to lock in on database state.
    */
    const loadPromise = this.syncService.loadDatabasePayloads(databasePayloads)
      .then(async () => {
        if (this.dealloced) {
          throw 'Application has been destroyed.';
        }
        await this.handleStage(ApplicationStages.LoadedDatabase_12);
        this.beginAutoSyncTimer();
        return this.syncService.sync({
          mode: SyncModes.DownloadFirst
        });
      });
    if (awaitDatabaseLoad) {
      await loadPromise;
    }
  }

  /**
   * @access private
   */
  beginAutoSyncTimer() {
    this.autoSyncInterval = this.deviceInterface.interval(() => {
      this.syncService.log('Syncing from autosync');
      this.sync();
    }, DEFAULT_AUTO_SYNC_INTERVAL);
  }

  /**
   * @access private
   * @param previousResponses Applications may require authetnication earlier than launch
   *                          in the case of migrations. We can reuse their valid responses.
   */
  async handleLaunchAuthentication() {
    const pendingChallenges = await this.deviceAuthService.getLaunchChallenges();
    await this.handleLaunchChallenge(pendingChallenges);
  }

  /** @access private */
  async handleLaunchChallenge(challenges) {
    const pendingChallenges = challenges.slice();
    while (pendingChallenges.length > 0) {
      const response = await this.launchCallbacks.requiresChallengeResponses(pendingChallenges);
      const responses = Array.isArray(response) ? response : [response];
      for (const response of responses) {
        const valid = await this.deviceAuthService.validateChallengeResponse(response);
        if (valid) {
          await this.deviceAuthService.handleChallengeResponse(response);
          removeFromArray(pendingChallenges, response.challenge);
        } else {
          await this.launchCallbacks.handleChallengeFailures([response]);
        }
      }
    }
  }

  /** @access private */
  getMigrationChallengeResponder() {
    return async (challenge) => {
      const responses = await this.launchCallbacks.requiresChallengeResponses([challenge]);
      return responses[0];
    };
  }

  /** @access private */
  async handleStage(stage) {
    for (const service of this.services) {
      await service.handleApplicationStage(stage);
    }
  }

  /** 
   * @access public
   * @param {function} callback
   * @param {ApplicationEvent} [singleEvent]  Whether to only listen for a particular event.
   */
  addEventObserver(callback, singleEvent) {
    const observer = { callback, singleEvent };
    this.eventHandlers.push(observer);
    return () => {
      removeFromArray(this.eventHandlers, observer);
    };
  }

  /**
  * @access public
  * @param {ApplicationEvent} singleEvent  Event to listen for.
  * @param {function} callback
  */
  addSingleEventObserver(event, callback) {
    return this.addEventObserver((firedEvent) => {
      if (firedEvent === event) {
        callback();
      }
    }, event);
  }

  /** @access private */
  async notifyEvent(event, data) {
    for (const observer of this.eventHandlers.slice()) {
      if (observer.singleEvent &amp;&amp; observer.singleEvent === event) {
        await observer.callback(event, data || {});
      } else if (!observer.singleEvent) {
        await observer.callback(event, data || {});
      }
    }
  }

  /** 
   * Whether the local database has completed loading local items.
   * @access public 
   */
  isDatabaseLoaded() {
    return this.syncService.isDatabaseLoaded();
  }

  /** @access public */
  async savePayload({ payload }) {
    const dirtied = CopyPayload({
      payload: payload,
      override: {
        dirty: true
      }
    });
    await this.modelManager.mapPayloadToLocalItem({ payload: dirtied });
    await this.syncService.sync();
  }

  /** 
   * Finds an item by UUID.
   * @access public 
   * @param uuid  The uuid of the item to find.
   */
  findItem({ uuid }) {
    return this.modelManager.findItem(uuid);
  }

  /** 
   * Finds an item by predicate.
  * @access public 
  */
  findItems({ predicate }) {
    return this.modelManager.itemsMatchingPredicate(predicate);
  }

  /** @access public */
  async mergeItem({ item, source }) {
    return this.modelManager.mapItem({ item, source });
  }

  /** 
   * @access public 
   * @param add  Whether to add the item to application state.
   * @param needsSync  Whether to mark the item as needing sync. `add` must also be true.
   */
  async createItem({ contentType, content, add, needsSync }) {
    const item = await this.modelManager.createItem({
      contentType,
      content,
      add,
      needsSync
    });
    return item;
  }

  /** @access public */
  async saveItem({ item }) {
    await this.modelManager.setItemDirty(item, true);
    await this.syncService.sync();

    if (item.content_type === ContentTypes.Tag) {
      this.modelManager.reorderTagLocation(item);
    }
  }

  /** 
   * @access public 
   * @param {Array.&lt;SFItem>} params.items
   */
  async saveItems({ items }) {
    await this.modelManager.setItemsDirty(items);
    await this.syncService.sync();
  }

  /** 
   * @access public 
   * @param {SFItem} params.item
   * @param {bool} params.updateUserModifiedDate  Whether to change the modified date the user 
   * sees of the item.
   */
  async setItemNeedsSync({ item, updateUserModifiedDate }) {
    return this.modelManager.setItemDirty(item, true, updateUserModifiedDate);
  }

  /** 
   * @access public 
   * @param updateUserModifiedDate  
   *  Whether to change the modified date the user sees of the item.
   */
  async setItemsNeedsSync({ items }) {
    return this.modelManager.setItemsDirty(items);
  }

  /** @access public */
  async deleteItem({ item }) {
    this.modelManager.setItemToBeDeleted(item);
    this.sync();
  }

  /** @access public */
  async deleteItemLocally({ item }) {
    this.modelManager.removeItemLocally(item);
  }

  /** @access public */
  async emptyTrash() {
    return this.modelManager.emptyTrash();
  }

  /** @access public */
  getTrashedItems() {
    return this.modelManager.trashedItems();
  }

  /** 
   * @access public 
   * @param {string|ContentType} contentType  A string, array of strings, or '*'
   */
  getItems({ contentType }) {
    return this.modelManager.getItems(contentType);
  }

  /** @access public */
  getDisplayableItems({ contentType }) {
    return this.modelManager.validItemsForContentType(contentType);
  }

  /** @access public */
  getNotesMatchingSmartTag({ smartTag }) {
    return this.modelManager.notesMatchingSmartTag(smartTag);
  }

  /** @access public */
  findTag({ title }) {
    return this.modelManager.findTag({ title });
  }

  /** @access public */
  async findOrCreateTag({ title }) {
    return this.modelManager.findOrCreateTag({ title });
  }

  /** @access public */
  getSmartTags() {
    return this.modelManager.getSmartTags();
  }

  /** @access public */
  getNoteCount() {
    return this.modelManager.noteCount();
  }


  /** 
   * Begin streaming items to display in the UI.
   * @access public 
   * @param contentType  Can be string, '*', or array of types.
   */
  streamItems({ contentType, stream }) {
    const observer = this.modelManager.addMappingObserver(
      contentType,
      (allItems, validItems, deletedItems, source, sourceKey) => {
        const includedContentTypes = allItems.map((item) => item.content_type);
        stream({
          items: allItems,
          contentTypes: includedContentTypes,
          source: source,
          sourceKey: sourceKey
        });
      }
    );
    this.streamObservers.push(observer);
    return () => {
      removeFromArray(this.streamObservers, observer);
    };
  }

  /** @access public */
  async setHost(host) {
    return this.apiService.setHost(host);
  }

  /** @access public */
  async getHost() {
    return this.apiService.getHost();
  }

  /** @access public */
  getUser() {
    if (!this.unlocked) {
      throw 'Attempting to access user before application unlocked';
    }
    return this.sessionManager.getUser();
  }

  /** @access public */
  async getUserVersion() {
    return this.protocolService.getUserVersion();
  }

  /** @access public */
  noAccount() {
    const user = this.getUser();
    return isNullOrUndefined(user);
  }

  /** 
   * @access public 
   * @param {object} params.data
   * @param {string} params.password
   * @param {bool} [params.awaitSync = false]
   * @returns {Object}  result
   * @returns {Array.&lt;SFItem>} result.affectedItems  Items that were either created
   *          or dirtied by this import
   * @returns {int} result.errorCount  The number of items
   *          that were not imported due to failure to decrypt.
   */
  async importData({ data, password, awaitSync }) {
    const decryptedPayloads = await this.protocolService.payloadsByDecryptingBackupFile({
      data: data,
      password: password
    });
    const validPayloads = decryptedPayloads.filter((payload) => {
      return !payload.errorDecrypting;
    });
    const affectedItems = await this.modelManager.importPayloads(validPayloads);
    const promise = this.sync();
    if(awaitSync) {
      await promise;
    }
    return {
      affectedItems: affectedItems,
      errorCount: decryptedPayloads.length - validPayloads.length
    };
  }

  /** @access public */
  isEphemeralSession() {
    return this.storageService.isEphemeralSession();
  }

  /** @access private */
  lockSyncing() {
    this.syncService.lockSyncing();
  }

  /** @access private */
  unlockSyncing() {
    this.syncService.unlockSyncing();
  }

  /** @access public */
  async getSyncStatus() {
    return this.syncService.status;
  }

  /** @access public */
  async sync(options) {
    return this.syncService.sync(options);
  }

  /** @access public */
  async resolveOutOfSync() {
    return this.syncService.resolveOutOfSync();
  }

  /** @access public */
  async setValue(key, value, mode) {
    return this.storageService.setValue(key, value, mode);
  }

  /** @access public */
  async getValue(key, mode) {
    return this.storageService.getValue(key, mode);
  }

  /** @access public */
  async removeValue(key, mode) {
    return this.storageService.removeValue(key, mode);
  }

  /** 
   * Deletes all payloads from storage.
   * @access public 
   */
  async clearDatabase() {
    return this.storageService.clearAllPayloads();
  }

  /** 
   * Allows items keys to be rewritten to local db on local credential status change,
   * such as if passcode is added, changed, or removed.
   * This allows IndexedDB unencrypted logs to be deleted
   * `deletePayloads` will remove data from backing store,
   * but not from working memory See:
   * https://github.com/standardnotes/desktop/issues/131
   * @access private 
   */
  async rewriteItemsKeys() {
    const itemsKeys = this.itemsKeyManager.allItemsKeys;
    const payloads = itemsKeys.map((key) => key.payloadRepresentation());
    await this.storageService.deletePayloads(payloads);
    await this.syncService.persistPayloads({
      decryptedPayloads: payloads
    });
  }

  /** @access public */
  async restart() {
    await this.deinit();
    this.dealloced = false;
    this.constructServices();
    await this.prepareForLaunch({ callbacks: this.launchCallbacks });
    await this.launch({ awaitDatabaseLoad: true });
  }

  /**
   * Destroys the application instance.
   * @access public
   */
  async deinit() {
    clearInterval(this.autoSyncInterval);
    for (const uninstallObserver of this.serviceObservers) {
      uninstallObserver();
    }
    for (const uninstallSubscriber of this.managedSubscribers) {
      uninstallSubscriber();
    }
    for (const service of this.services) {
      if (service.deinit) {
        await service.deinit();
      }
    }
    this.streamObservers = [];
    this.clearServices();
    this.dealloced = true;
    this.started = false;
  }

  /**
   * Allows your PureService subclass to receive `deinit` event to unload observers.
   * @access public
   */
  registerService(service) {
    this.services.push(service);
  }

  /**
   *  @access public
   *  @param mergeLocal  Whether to merge existing offline data into account. If false,
   *                     any pre-existing data will be fully deleted upon success.
   */
  async register({ email, password, ephemeral, mergeLocal }) {
    this.lockSyncing();
    const result = await this.sessionManager.register({
      email, password
    });
    this.unlockSyncing();
    if (!result.response.error) {
      await this.keyManager.setNewRootKey({
        key: result.rootKey,
        keyParams: result.keyParams
      });
      this.syncService.resetSyncState();
      await this.storageService.setPersistencePolicy(
        ephemeral
          ? StoragePersistencePolicies.Ephemeral
          : StoragePersistencePolicies.Default
      );
      if (mergeLocal) {
        await this.syncService.markAllItemsAsNeedingSync({
          alternateUuids: true
        });
      } else {
        this.modelManager.removeAllItemsFromMemory();
        await this.clearDatabase();
      }
      await this.notifyEvent(ApplicationEvents.SignedIn);
      await this.syncService.sync({
        mode: SyncModes.DownloadFirst
      });
      this.protocolService.decryptErroredItems();
    }
    return result.response;
  }

  /**
   *  @access public 
   *  @param mergeLocal  Whether to merge existing offline data into account. If false, 
   *                     any pre-existing data will be fully deleted upon success.
   */
  async signIn({ email, password, strict, ephemeral, mfaKeyPath, mfaCode, mergeLocal = true }) {
    /** Prevent a timed sync from occuring while signing in. */
    this.lockSyncing();
    const result = await this.sessionManager.signIn({
      email, password, strict, mfaKeyPath, mfaCode
    });
    this.unlockSyncing();
    if (!result.response.error) {
      await this.keyManager.setNewRootKey({
        key: result.rootKey,
        keyParams: result.keyParams
      });
      this.syncService.resetSyncState();
      await this.storageService.setPersistencePolicy(
        ephemeral
          ? StoragePersistencePolicies.Ephemeral
          : StoragePersistencePolicies.Default
      );
      if (mergeLocal) {
        await this.syncService.markAllItemsAsNeedingSync({
          alternateUuids: true
        });
      } else {
        this.modelManager.removeAllItemsFromMemory();
        await this.clearDatabase();
      }
      await this.notifyEvent(ApplicationEvents.SignedIn);
      await this.syncService.sync({
        mode: SyncModes.DownloadFirst,
        checkIntegrity: true
      });
      this.protocolService.decryptErroredItems();
    }
    return result.response;
  }

  /** @access public */
  async changePassword({ email, currentPassword, newPassword, rotateItemsKey }) {
    const currentKeyParams = await this.keyManager.getRootKeyParams();
    this.lockSyncing();
    const result = await this.sessionManager.changePassword({
      email, currentPassword, currentKeyParams, newPassword
    });
    this.unlockSyncing();
    if (!result.response.error) {
      await this.keyManager.setNewRootKey({
        key: result.rootKey,
        keyParams: result.keyParams
      });
      const newKeyParams = result.keyParams;
      const versionUpgraded = newKeyParams.version !== currentKeyParams.version;
      if (rotateItemsKey || versionUpgraded) {
        await this.itemsKeyManager.createNewDefaultItemsKey();
      }
      await this.syncService.sync();
    }
    return result.response;
  }

  /** @access public */
  async signOut() {
    await this.sessionManager.signOut();
    await this.keyManager.clearLocalKeyState();
    await this.storageService.clearAllData();
    await this.notifyEvent(ApplicationEvents.SignedOut);
    await this.restart();
  }

  /** @access public */
  async validateAccountPassword({ password }) {
    return this.keyManager.validateAccountPassword(password);
  }

  /** @access public */
  isStarted() {
    return this.started;
  }

  /** @access public */
  hasPasscode() {
    return this.keyManager.hasPasscode();
  }

  /** @access public */
  async isLocked() {
    if (!this.started) {
      return true;
    }
    return this.deviceAuthService.isPasscodeLocked();
  }

  /** @access public */
  async lock() {
    return this.restart();
  }

  /** @access public */
  async setPasscode(passcode) {
    const identifier = await this.protocolService.crypto.generateUUID();
    const { key, keyParams } = await this.protocolService.createRootKey({
      identifier: identifier,
      password: passcode
    });
    await this.keyManager.setNewRootKeyWrapper({
      wrappingKey: key,
      keyParams: keyParams
    });
    await this.rewriteItemsKeys();
    await this.syncService.sync();
  }

  /** @access public */
  async removePasscode() {
    await this.keyManager.removeRootKeyWrapper();
    await this.rewriteItemsKeys();
  }

  /** @access public */
  async changePasscode(passcode) {
    await this.removePasscode();
    return this.setPasscode(passcode);
  }

  /** @access public */
  async setStorageEncryptionPolicy(encryptionPolicy) {
    await this.storageService.setEncryptionPolicy(encryptionPolicy);
    return this.syncService.repersistAllItems();
  }


  /** @access public */
  async generateUuid() {
    return this.protocolService.crypto.generateUUID();
  }

  /**
   * Dynamically change the device interface, i.e when Desktop wants to override
   * default web interface.
   * @access public
   */
  async changeDeviceInterface(deviceInterface) {
    this.deviceInterface = deviceInterface;
    this.keyManager.setDeviceInterface(this.deviceInterface);
  }

  /** @access private */
  constructServices() {
    this.createModelManager();
    this.createProtocolService(this.modelManager);
    this.createMigrationService();
    this.createAlertManager();
    this.createHttpManager();
    this.createStorageManager();
    this.createApiService();
    this.createSessionManager();
    this.createSyncManager();
    this.createItemsKeyManager();
    this.createKeyManager();
    this.protocolService.setKeyManager(this.keyManager);
    this.protocolService.setItemsKeyManager(this.itemsKeyManager);
    this.itemsKeyManager.setKeyManager(this.keyManager);
    this.keyManager.setDeviceInterface(this.deviceInterface);
    this.createDeviceAuthService();
    this.createSingletonManager();
    this.createComponentManager();
    this.createPrivilegesManager();
    this.createHistoryManager();
    this.createActionsManager();
  }

  /** @access private */
  clearServices() {
    this.migrationService = null;
    this.alertService = null;
    this.httpService = null;
    this.modelManager = null;
    this.protocolService = null;
    this.storageService = null;
    this.apiService = null;
    this.sessionManager = null;
    this.syncService = null;
    this.keyManager = null;
    this.itemsKeyManager = null;
    this.deviceAuthService = null;
    this.singletonManager = null;
    this.componentManager = null;
    this.privilegesService = null;
    this.actionsManager = null;

    this.services = [];
  }

  createMigrationService() {
    this.migrationService = new (this.getClass(SNMigrationService))({
      application: this,
      challengeResponder: this.getMigrationChallengeResponder()
    });
    this.services.push(this.migrationService);
  }

  createAlertManager() {
    if (this.shouldSkipClass(SNAlertService)) {
      return;
    }
    this.alertService = new (this.getClass(SNAlertService))({
      deviceInterface: this.deviceInterface
    });
    this.services.push(this.alertService);
  }

  createApiService() {
    this.apiService = new (this.getClass(SNApiService))({
      storageService: this.storageService,
      httpService: this.httpService,
      host: this.host
    });
    this.services.push(this.apiService);
  }

  createComponentManager() {
    if (this.shouldSkipClass(SNComponentManager)) {
      return;
    }
    this.componentManager = new (this.getClass(SNComponentManager))({
      modelManager: this.modelManager,
      syncService: this.syncService,
      alertService: this.alertService,
      timeout: this.deviceInterface.timeout,
      environment: this.environment,
      platform: this.platform
    });
    this.services.push(this.componentManager);
  }

  createHttpManager() {
    this.httpService = new (this.getClass(SNHttpService))();
    this.services.push(this.httpService);
  }

  createKeyManager() {
    this.keyManager = new (this.getClass(SNKeyManager))({
      modelManager: this.modelManager,
      storageService: this.storageService,
      protocolService: this.protocolService,
      itemsKeyManager: this.itemsKeyManager
    });
    this.keyManager.onStatusChange(async () => {
      await this.notifyEvent(ApplicationEvents.KeyStatusChanged);
    });
    this.services.push(this.keyManager);
  }

  createItemsKeyManager() {
    this.itemsKeyManager = new (this.getClass(ItemsKeyManager))({
      modelManager: this.modelManager,
      syncService: this.syncService,
      protocolService: this.protocolService
    });
    this.services.push(this.itemsKeyManager);
  }

  createModelManager() {
    this.modelManager = new (this.getClass(SNModelManager))({
      timeout: this.deviceInterface.timeout
    });
    this.services.push(this.modelManager);
  }

  createSingletonManager() {
    this.singletonManager = new (this.getClass(SNSingletonManager))({
      modelManager: this.modelManager,
      syncService: this.syncService
    });
    this.services.push(this.singletonManager);
  }

  createStorageManager() {
    this.storageService = new (this.getClass(SNStorageService))({
      protocolService: this.protocolService,
      namespace: this.namespace,
      deviceInterface: this.deviceInterface
    });
    this.services.push(this.storageService);
  }

  createProtocolService(modelManager) {
    this.protocolService = new (this.getClass(SNProtocolService))({
      modelManager: modelManager,
      crypto: this.crypto
    });
    this.services.push(this.protocolService);
  }

  createSessionManager() {
    this.sessionManager = new (this.getClass(SNSessionManager))({
      storageService: this.storageService,
      alertService: this.alertService,
      protocolService: this.protocolService,
      apiService: this.apiService,
      timeout: this.deviceInterface.timeout
    });
    this.services.push(this.sessionManager);
  }

  createSyncManager() {
    this.syncService = new (this.getClass(SNSyncService))({
      modelManager: this.modelManager,
      storageService: this.storageService,
      sessionManager: this.sessionManager,
      protocolService: this.protocolService,
      apiService: this.apiService,
      interval: this.deviceInterface.interval
    });
    const uninstall = this.syncService.addEventObserver(async (eventName) => {
      const appEvent = applicationEventForSyncEvent(eventName);
      if(appEvent) {
        await this.notifyEvent(appEvent);
      }
    });
    this.serviceObservers.push(uninstall);
    this.services.push(this.syncService);
  }

  createDeviceAuthService() {
    this.deviceAuthService = new (this.getClass(DeviceAuthService))({
      storageService: this.storageService,
      protocolService: this.protocolService,
      keyManager: this.keyManager
    });
    this.services.push(this.deviceAuthService);
  }

  createPrivilegesManager() {
    this.privilegesService = new (this.getClass(SNPrivilegesService))({
      storageService: this.storageService,
      keyManager: this.keyManager,
      modelManager: this.modelManager,
      syncService: this.syncService,
      sessionManager: this.sessionManager,
      singletonManager: this.singletonManager
    });
    this.services.push(this.privilegesService);
  }

  createHistoryManager() {
    this.historyManager = new (this.getClass(SNHistoryManager))({
      storageService: this.storageService,
      modelManager: this.modelManager,
      contentTypes: [ContentTypes.Note],
      timeout: this.deviceInterface.timeout
    });
    this.services.push(this.historyManager);
  }

  createActionsManager() {
    this.actionsManager = new (this.getClass(SNActionsService))({
      alertService: this.alertService,
      deviceInterface: this.deviceInterface,
      httpService: this.httpService,
      modelManager: this.modelManager,
      protocolService: this.protocolService,
      syncService: this.syncService,
    });
    this.services.push(this.actionsManager);
  }

  shouldSkipClass(classCandidate) {
    return this.skipClasses &amp;&amp; this.skipClasses.includes(classCandidate);
  }

  getClass(base) {
    const swapClass = this.swapClasses &amp;&amp; this.swapClasses.find((candidate) => candidate.swap === base);
    if (swapClass) {
      return swapClass.with;
    } else {
      return base;
    }
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Fri Feb 28 2020 14:33:50 GMT-0600 (Central Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
